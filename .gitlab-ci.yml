stages:
  - build

stg-build:
  stage: build
  variables:
    GIT_STRATEGY: fetch
  tags:
    - build
  only:
    - staging
  script:
    - docker build . -t website-builder:$CI_PIPELINE_ID
    - docker run --rm -v $PWD/dist:/app/dist website-builder:$CI_PIPELINE_ID
    - docker rmi website-builder:$CI_PIPELINE_ID
    - rm -rf /var/www/stg-root/*
    - cp -r dist/ceit94/* /var/www/stg-root/

prod-build:
  stage: build
  variables:
    GIT_STRATEGY: fetch
  tags:
    - build
  only:
    - master
  script:
    - docker build . -t website-builder:$CI_PIPELINE_ID
    - docker run --rm -v $PWD/dist:/app/dist:rw website-builder:$CI_PIPELINE_ID
    - docker rmi website-builder:$CI_PIPELINE_ID
    - rm -rf /var/www/stg-root/*
    - cp -r dist/ceit94/* /var/www/prod-root/
